<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=no">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <style>
            body, html, video, #videocontainer {
                margin:0;
                padding:0;
                background:#000;
                height: 100%;
                width: 100%;
            }
            body {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            video {
                object-fit: contain;
            }
            video::-webkit-media-controls {
                display:none !important;
            }
            #controls {
                z-index: 2147483647;
                display: block;
                position: fixed;
                top: 50%;
                list-style: none;
            }
            #controls button {
                -moz-appearance: none;
                -webkit-appearance: none;
                background: none;
                border: none;
                outline: none;
            }
            .material-icons.md-48 {
                font-size: 48px;
            }
            .material-icons.md-light {
                color: rgba(255, 255, 255, 1);
            }
            .fade-out {
                display: block;
                visibility: hidden;
                opacity: 0;

                -webkit-transition: visibility 1.5s, opacity 1.5s;
                    -moz-transition: visibility 1.5s, opacity 1.5s;
                    -ms-transition: visibility 1.5s, opacity 1.5s;
                    -o-transition: visibility 1.5s, opacity 1.5s;
                        transition: visibility 1.5s, opacity 1.5s;

                /* Wait a moment before fading out the control bar */
                -webkit-transition-delay: 2s;
                    -moz-transition-delay: 2s;
                    -ms-transition-delay: 2s;
                    -o-transition-delay: 2s;
                        transition-delay: 2s;
            }
        </style>
    </head>
    <body>
        <div id="videocontainer">
            <video autoplay muted>
                <source type="video/mp4">
                Your browser does not support mp4 video.
            </video>
            <ul id="controls">
                <li><button id="fullscreen" type="button"><i class="material-icons md-light md-48">fullscreen</i></button></li>
                <li><button id="playpause" type="button"><i class="material-icons md-light md-48">pause</i></button></li>
                <li><button id="next" type="button"><i class="material-icons md-light md-48">skip_next</i></button></li>
            </ul>
        </div>

        <script>
            const video = document.querySelector('video');
            const videoContainer = document.querySelector('#videocontainer');
            const fullscreenButton = document.querySelector('#fullscreen');
            const playpauseButton = document.querySelector('#playpause');
            const nextButton = document.querySelector('#next');
            const controls = document.querySelector('#controls');

            function getRandomVideo() {
                const url = '/api/post.json?limit=1&page=' + Math.floor(Math.random() * 15390) + '&tags=fighting';
                return fetch(url).then(response => response.json().then(data => data[0].file_url));
            }
            function playNext() {
                getRandomVideo().then(src => {
                    video.src = src;
                    video.play();
                });
            }

            video.addEventListener('ended', playNext);
            var fullScreenEnabled = !!(document.fullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitSupportsFullscreen || document.webkitFullscreenEnabled || document.createElement('video').webkitRequestFullScreen);
            if (!fullScreenEnabled) {
                fullscreenButton.style.display = 'none';
            }
            var isFullScreen = function() {
                return !!(document.fullScreen || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
            }
            var setFullscreenData = function(state) {
                videoContainer.setAttribute('data-fullscreen', !!state);
            }
            var handleFullscreen = function() {
                if (isFullScreen()) {
                    if (document.exitFullscreen) document.exitFullscreen();
                    else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                    else if (document.webkitCancelFullScreen) document.webkitCancelFullScreen();
                    else if (document.msExitFullscreen) document.msExitFullscreen();
                    setFullscreenData(false);
                }
                else {
                    if (videoContainer.requestFullscreen) videoContainer.requestFullscreen();
                    else if (videoContainer.mozRequestFullScreen) videoContainer.mozRequestFullScreen();
                    else if (videoContainer.webkitRequestFullScreen) videoContainer.webkitRequestFullScreen();
                    else if (videoContainer.msRequestFullscreen) videoContainer.msRequestFullscreen();
                    setFullscreenData(true);
                }
            }
            document.addEventListener('fullscreenchange', (e) =>
                setFullscreenData(!!(document.fullScreen || document.fullscreenElement))
            );
            document.addEventListener('webkitfullscreenchange', () =>
                setFullscreenData(!!document.webkitIsFullScreen)
            );
            document.addEventListener('mozfullscreenchange', () =>
                setFullscreenData(!!document.mozFullScreen)
            );
            document.addEventListener('msfullscreenchange', () =>
                setFullscreenData(!!document.msFullscreenElement)
            );
            fullscreenButton.addEventListener('click', handleFullscreen);
            playpauseButton.addEventListener('click', e => {
                if (video.paused || video.ended) video.play();
                else video.pause();
            });
            nextButton.addEventListener('click', playNext);
            videoContainer.addEventListener('mouseout', () => {
                controls.classList.add('fade-out')
                console.log("test fade out");
            });

            videoContainer.addEventListener('mouseover', () => {
                controls.classList.remove('fade-out');
                console.log("come back");
            });
            getRandomVideo().then(src => {
                video.src = src;
                video.play();
            })

        </script>
    </body>
</html>
